## 数据链路层

> 把实现通信协议的硬件和软件加到链路上，就构成了数据链路层
>
>  
>
> 以帧为单位传输和处理数据

## 1. 封装成帧

> 数据链路层为网络层的数据添加**帧首**和**帧尾**使之成为帧的过程

<img src="https://s2.loli.net/2022/03/29/obhisnpjWaZ1fQX.png" alt="image-20210128165621909" style="zoom: 67%;" />

**透明传输**：不会修改上层传输的数据，数据会完整的传输到其他层

- 字节填充

  > 使用帧头帧尾来区分帧（如果数据和头尾一样用转义符号来防止）

- 比特填充

  > 每5个连续1插入0，避免混淆

## 2. 差错检测

> 比特传输过程中会出现差错，差错总数称为：**误码率BER**

### 1.奇偶校验

> 奇数个 1 ，还是偶数个 1来进行校验

### 2. 循环冗余校验CRC

1. 约定生成一个多项式`G(X)`，数据添加该多项式最高次数个0（比如$x^3$就需要添加3个零）

<img src="https://s2.loli.net/2022/03/29/Cfli6t9x7HBIdFA.png" alt="image-20210129164100468" style="zoom:50%;" />

2. **发送方**把数据 %（多项式系数构成）除数 的余数添加到数据一起传输

   > 取余过程中各位用异或进行处理

3. **接收方**把数据（包括冗余数） %  (多项式系数构成）除数，如果余数为零就没有出错

<img src="https://s2.loli.net/2022/03/29/ubpQrqoEYv3AHNI.png" alt="image-20210129164028312" style="zoom:50%;" />

除法过程：

<img src="https://s2.loli.net/2022/03/29/FuQlLkHaW9Z8Dm5.png" alt="image-20210129164909285" style="zoom:50%;" />

- **检错码**只能检错，CRC检错能力很高，较少的误判率，易于实现。
- 如果发现出错，计算机网络采用**重传的方式来纠正**（简单粗暴）

## 3. 可靠传输

> 不可靠传输：仅仅丢弃有误码的帧，其他什么也不做
>
> 可靠传输：通过其他方法保证发送端和接收端的接收的内容一致

- **有线链路**的误码率较低，一般不用可靠传输；**无线链路**误码率较高，必须要求使用可靠传输
- 传输差错还包括运输层中的分组丢失，失序，重复

### 1. 停止-等待协议SW

发送-->接收-->确认（成功/失败）

1. 避免重复接收：序号区分
2. 避免死锁：计时器
3. 避免接收双方序号出现冲突：双方都有各自的序号

<img src="https://s2.loli.net/2022/03/29/XrjgpeWnytImd4N.png" alt="image-20210130155951376" style="zoom:50%;" />

<img src="https://s2.loli.net/2022/03/29/cI4nbv7gSTZy98a.png" alt="image-20210130160600416" style="zoom:50%;" />

> $T_A$通常很小

### 2. 回退N帧协议GBN

> 为了减少传播时延，同时发送多个分组（发送窗口），接收按顺序接收（1的大小的接收窗口）
>
> 发送窗口大小是不能大于分组长度的一半，否则不能区分是**重传**还是**正常接收**

<img src="https://s2.loli.net/2022/03/29/OhsZBx3FP5wKJzn.png" alt="image-20210130163316987" style="zoom:50%;" />

<img src="https://s2.loli.net/2022/03/29/hkRGJaV2pbSvmq9.png" alt="image-20210130162603910" style="zoom:50%;" />

### 3. 选择重传协议SR

> 为了避免第一个顺序误码而导致接收的所有分组失效，所以接收窗口有多个

<img src="https://s2.loli.net/2022/03/29/FSRLW4iQ9JO3b2M.png" alt="image-20210130165642553" style="zoom:50%;" />

<img src="https://s2.loli.net/2022/03/29/cy5t3RPkrVqIKCS.png" alt="image-20210130165330624" style="zoom:50%;" />

## 4. PPP协议

> 数据链路层协议，用于规定帧格式

<img src="https://s2.loli.net/2022/03/29/WKzUXiq9gGNZfom.png" alt="image-20210201201917595" style="zoom:50%;" />

### 透明传输

1. 字节填充法

- 和帧首尾一样的7E 前面插入 7D（转义字符）+（7E-20）==7D5E
- 对于本来就有的7D（转义字符），7D+(7D-20)==7D5E
- 对于`Ascall`控制符，如03 ： 7D+03+20==7D23

<img src="https://s2.loli.net/2022/03/29/Et78yagOBYbvNGW.png" alt="image-20210201203628640" style="zoom:50%;" />

2. 比特填充法
   + **发送方**：对帧的数据部分进行扫描(一般由硬件实现)。只要**发现5个连续的比特1，则立即填充1个比特0**
   + **接收方**：对帧的数据部分进行扫描(一般由硬件实现)。只要**发现5个连续的比特1，就把其后的1个比特0删除**

> 接收方都是反规则进行还原即可
>
> 差错检测：
>
> 采用的时`crc`检验

## 5. 媒体接入层

> 多个发送端和一个接收端对于共享一条线路的问题，媒体既接入控制MAC`(`Medium Access Control`)`

概念：**复用**：一条线路同时传输多路用户

<img src="https://s2.loli.net/2022/03/29/sx49U8GWoMyzXvu.png" alt="image-20210322202556354" style="zoom:50%;" />

### 1. 频分复用FDM

> 复用器将资源划分成多个子频带，分用器在组合

<img src="https://s2.loli.net/2022/03/29/A9EZ7R4zBVomyeU.png" alt="image-20210322204101543" style="zoom:50%;" />

### 2. 时分复用TDM

> 按时间分配固定的资源

<img src="https://s2.loli.net/2022/03/29/SALTRcrwCotmn4D.png" alt="image-20210322210341303" style="zoom:50%;" />

### 3. 波分复用WDM

> 通过光调制到不同的波长，得以在一根光纤中传输

<img src="https://s2.loli.net/2022/03/29/lgosMGk85SI3rLf.png" alt="image-20210322211112508" style="zoom:50%;" />

### 4. 码分复用CDM

> 各用户使用不同的码型来避免干扰
>
> **码片**：在CDMA中由每个比特时间再划分为 m 个短的间隔

<img src="https://s2.loli.net/2022/03/29/9ZTg3HwV78uRjML.png" alt="image-20210322213435188" style="zoom:50%;" />

**码片的原则：**

1. 各个码片必须各不相同，常采用伪随机码序列

2. 必须相互正交（规格化内积为 0 ）

   $S*T\equiv0$  未传播

   $S*\overline T\equiv0$ 未传播

   $S*S\equiv1$ 传播 1

   $S*\overline S\equiv-1$ 传播 0

<img src="https://s2.loli.net/2022/03/29/caRbiq3C8J9gDZj.png" alt="image-20210322214653701" style="zoom:50%;" />

### 复用与多址

**复用**：

> 将频带资源划分成**独立的子信道**

**多址**：

> 动态**暂时**分配信道给用户（如移动通信）

