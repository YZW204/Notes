## 网络层

> 实现网络互连，进而实现数据包在各网络间的传输

## 1.面向连接的虚电路服务

- 需要可靠的通信网络，建立网络层的连接**虚电路**
- 双方沿着**已建立的虚电路发送分组**
- 分组只需要携带虚电路的编号
- 如果使用可靠传输协议，就可使发送的分组最终正确到达接收方
- 通信结束释放之前所建立的虚电路

## 2. 无连接的数据报服务

- 可靠通信**由用户主机来保证**
- **不需要建立网络层连接，每个分组可以走不同路径**
- 必须携带目的主机完整地址
- **会产生误码、丢失、重复和失序的问题**
- 网络本身不提供端到端的可靠传输服务，因此，路由器的构造做得比较简单，价格低廉
- **将复杂的网络处理功能置于用户主机和主机的运输层**，而将相对简单的分组交付功能置于因特网中

## 3. IPv4地址

> `IPv4`地址就是因特网上**每一台主机（或路由器）的每个接口**分配的全世界**唯一的32比特标识符**

**分类编址**

<img src="https://s2.loli.net/2022/03/29/liMgrVT1UBoqRYb.png" alt="image-20210401111845620" style="zoom:50%;" />

- **A类：**第`1`位固定为`0`，**网络号不能全`0`,也不能全`1`，网络范围使`1~126`**
- **B类：前2位固定`10`，无限制，网络号范围使`128.0~191.255`**
- **C类：前3位固定`110`，无限制，网络号范围`192.0.0~223.255.255`**
- **D类：多播地址，范围`224.0.0.0~239.255.255`**

<img src="https://s2.loli.net/2022/03/29/hrtWKbXFQyp4uzL.png" alt="image-20210401122431550" style="zoom:50%;" />

<img src="https://s2.loli.net/2022/03/29/eXt4vl9SQwshcpW.png" alt="image-20210401122739887" style="zoom:50%;" />

#### 划分子网的IPV4地址

> 对一个网络号进行分网络管理，**节约地址，避免过多的申请网络号来管理网络**

**如何实现？**

> 通过借用主机号的比特来作为子网号

- 子网掩码**使用连续的比特 1 来对应网络号和子网号；使用连续的比特 0 来表示主机号**
- 将`ipv4`地址和子网掩码进行逻辑与运算就可以得到子网地址

#### 无分类编制的IPv4地址

> **数量巨大的C类网因为其他地址空间太小并没有得到充分使用，同时IPv4急剧消耗**
>
> 1993年，IETF发布**无分类域间路由选择CIDR**

- CIDR消除了传统的A类、B类和C类地址，还有子网概念

- **斜线记法**，或称CIDR记法。斜线后面写上网络前缀所占比特数量

  <img src="https://s2.loli.net/2022/03/29/14Hc2fDPeyAoUSb.png" alt="image-20210402092157889" style="zoom:50%;" />

- **CIDR实际上是将网络前缀相同的连续IP地址组成一个”CIDR地址块“**

**路由聚合**

> **将路由器中的网络共同前缀提取出来成为新的网络号，同时将剩余主机号置0放入路由器B中**
>
> 如：`A`连接了`172.1.4.0/25`和`172.1.7.0/24`，则提取公共前缀聚合后变为**172.1.4.0/22**



